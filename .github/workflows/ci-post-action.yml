name: Process Workflow Logs

on:
  workflow_run:
    workflows: ['Continuous Integration'] # Name of the primary workflow
    types:
      - completed

jobs:
  process-logs:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Download and Process Logs
        uses: ./
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          workflow-run-id: ${{ github.event.workflow_run.id }} # ID of the completed workflow run

      # Runs the action located at the root of the repository.
      - name: Run Local Action
        id: copilot
        uses: ./
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          openai-api-key: ${{ secrets.OPENAI_API_KEY }}
          workflow-run-id: ${{ github.event.workflow_run.id }} # ID of the completed workflow run

      # Print URL of the created GitHub Issue if any issue is created
      - name: Print Issue URL
        run: echo "${{ steps.copilot.outputs.issue-url }}"

      # Print URL of the created GitHub PR if any PR is created
      - name: Print PR URL
        run: echo "${{ steps.copilot.outputs.pr-url }}"
